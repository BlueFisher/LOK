@using Microsoft.AspNet.Identity.Owin;
@using Microsoft.AspNet.Identity;
@using Microsoft.Owin.Security;

<ul class="nav navbar-nav navbar-right">
	@if(Request.IsAuthenticated) {
		var UserManager = Context.GetOwinContext().GetUserManager<ApplicationUserManager>();
		string userId = User.Identity.GetUserId();
		ApplicationUser user = UserManager.FindById(userId);
		if(user == null) {
			// 身份信息错误
			Response.Cookies.Clear();
		}
		else {
			string roleName = ConfigControls.RolesMap[user.Roles.First().RoleId];
			// 已注册用户导航栏
			if(UserManager.IsInRole(userId, UserRolesEnum.SignedUp.ToString())) {
				<li class="dropdown">
					<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown">你好！ @user.NickName<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a href="/Business/Order">个人中心</a></li>
						<li><a href="/Account/SignOut">注销</a></li>
					</ul>
				</li>
			}
			// 管理员导航栏
			else if(UserManager.IsInRole(userId, UserRolesEnum.Admin.ToString())) {
				<li class="dropdown">
					<a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown">管理员你好！ @user.NickName<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li><a href="/Business/Order">个人中心</a></li>
						<li><a href="/Account/SignOut">注销</a></li>
					</ul>
				</li>
				<li><a href="/Admin/Index" class="btn-ripples">管理中心</a></li>
				<li><a href="/Admin/UsersControl" class="btn-ripples">用户中心</a></li>
				<li><a href="/Admin/Config" class="btn-ripples">设置中心</a></li>
				// 超级管理员增加的导航栏
				if(UserManager.IsInRole(userId, "SuperAdmin")) {
					<li><a href="/Admin/SuperAdminControl" class="btn-ripples" id="btn-myorder">超级管理员</a></li>
				}
			}
			// 匿名用户导航栏
			else {
				<li><a href="/Account/Index" class="btn-ripples">注册</a></li>
			}
			<li><a href="javascript:;" class="btn-ripples" id="btn-myorder">我的订单</a></li>
		}
	}
	// 未注册非匿名用户导航栏
	else {
		<li><a href="/Account/Index" class="btn-ripples">登录</a></li>
		<li><a href="/Account/Index" class="btn-ripples">注册</a></li>
	}
</ul>